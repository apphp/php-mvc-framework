<h1>Special Topics - Shopping Cart</h1>

<ul>
	<li><a href="#general">General</a></li>
	<li><a href="#initializing">Initializing the Shopping Cart Component</a></li>
	<li><a href="#adding-item-to-cart">Adding an Item to The Cart</a></li>
	<li><a href="#adding-multiple-items-to-cart">Adding Multiple Items to The Cart</a></li>
	<li><a href="#updating-item-in-cart">Updating The Cart</a></li>
	<li><a href="#displaying-the-cart">Displaying the Cart</a></li>
	<li><a href="#function-reference">Function Reference</a></li>
</ul>
<br />


<a name="general"></a>
<h3>General <a class="hashlink" href="#general">¶</a></h3>

<p>
The Shopping Cart functionality based on framework <code>CShopingCart</code> component, that permits items to be added to a
session that stays active while a user is browsing your site.
These items can be retrieved and displayed in a standard "shopping cart" format, allowing the user to update the quantity or
remove items from the cart.
</p>

<p>
Please note that the Cart Class ONLY provides the core "cart" functionality. It does not provide shipping,
credit card authorization, payment operations or other processing components.	
</p>
<br>


<a name="initializing"></a>
<h3>Initializing the Shopping Cart Component <a class="hashlink" href="#initializing">¶</a></h3>

<p>
ApPHP Framework provides automatic initialization of Shopping Cart Component.<br> 
Once loaded, the Cart object will be available using: <code>A::app()->getShoppingCart()</code>
</p>
<div class="msg_important">
Note: The CShoppingCart component will load and initialize the Session component automatically, so you do not need to load the Session component.
</div>

<br>


<a name="adding-item-to-cart"></a>
<h3>Adding an Item to The Cart <a class="hashlink" href="#adding-item-to-cart">¶</a></h3>

<p>
	To add an item to the shopping cart, simply pass an array with the product information to the
	<code>A::app()->getShoppingCart()->insert()</code> function, as shown below:
</p>
<br />

<pre name="dlhl" class="php">
$data = array(
    'id'      => 'SKU_123456',
    'qty'     => 2,
    'price'   => 29.90,
    'name'    => 'T-Shirt',
    'options' => array('Size' => 'M', 'Color' => 'Black', 'Type' => 'V')
);

A::app()->getShoppingCart()->insert($data); 
</pre>
<br />


<a name="adding-multiple-items-to-cart"></a>
<h3>Adding Multiple Items to The Cart <a class="hashlink" href="#adding-multiple-items-to-cart">¶</a></h3>

<p>
	You may use a multi-dimensional array, as shown below, it is possible to add multiple products to the cart in one action.
	This is useful in cases where you wish to allow people to select from among several items on the same page.	
</p>

<pre name="dlhl" class="php">
$data = array(
array(
    'id'      => 'SKU_11111',
    'qty'     => 1,
    'price'   => 39.95,
    'name'    => 'T-Shirt'
),
array(
    'id'      => 'SKU_22222',
    'qty'     => 1,
    'price'   => 9.95,
    'name'    => 'Coffee Mug',
    'options' => array('Size' => 'L', 'Color' => 'Red')
),
array(
    'id'      => 'SKU_33333',
    'qty'     => 1,
    'price'   => 29.95,
    'name'    => 'Shot Glass'
));

A::app()->getShoppingCart()->insert($data); 
</pre>
<br />


<a name="updating-item-in-cart"></a>
<h3>Updating The Cart <a class="hashlink" href="#updating-item-in-cart">¶</a></h3>

<p>
	To update the information in your cart, you must pass an array containing the <code>RowID</code> and
	quantity to the <code>A::app()->getShoppingCart()->update()</code> function.
	What is a RowID?  The row ID is a unique identifier that is generated by the cart code when an item is added to the cart.
	The reason a unique ID is created is so that identical products with different options can be managed by the cart.
</p>

<div class="msg_important">Note: If the quantity is set to zero, the item will be removed from the cart.</div>

<pre name="dlhl" class="php">
$data = array(
    'rowid' => 'b94ccd516068f71558sf34d130b6d8ec',
    'qty'   => 3
);

A::app()->getShoppingCart()->update($data);

// Or a multi-dimensional array
$data = array(
    array(
        'rowid'   => 'b94ccd516068f71558sf34d130b6d8ec',
        'qty'     => 3
    ),
    array(
        'rowid'   => 'xw8259q36495793i8jdh973h90jikw23',
        'qty'     => 4
    ),
    array(
        'rowid'   => '4h5kdk7kao03fnjgoe9hrkdjkobec333',
        'qty'     => 2
    )
);

A::app()->getShoppingCart()->update($data); 
</pre>
<br />


<a name="displaying-the-cart"></a>
<h3>Displaying the Cart <a class="hashlink" href="#displaying-the-cart">¶</a></h3>

<p>
To display the cart you have to create a view file with code similar to the one shown below.<br>
Please note that this example uses the CShoppingCart component.
</p>

<pre name="dlhl" class="php">
&lt;table cellpadding="6" cellspacing="1" style="width:100%" border="0">
&lt;tr>
  &lt;th>QTY&lt;/th>
  &lt;th>Item Description&lt;/th>
  &lt;th style="text-align:right">Item Price&lt;/th>
  &lt;th style="text-align:right">Sub-Total&lt;/th>
&lt;/tr>
&lt;?php
$shoppingCart = A::app()->getShoppingCart();
$i = 1;
?>
&lt;?php foreach ($shoppingCart->contents() as $items): ?>
    &lt;tr>
        &lt;td>&lt;?= CHtml::textField($i.'[qty]', $items['qty'], array('maxlength'=>'3')); ?>&lt;/td>
        &lt;td>
        &lt;?= $items['name']; ?>

            &lt;?php if ($shoppingCart->hasOptions($items['rowid']) == true): ?>
                &lt;p>
                    &lt;?php foreach ($shoppingCart->productOptions($items['rowid']) as $optionName => $optionValue): ?>
                        &lt;strong>&lt;?= $optionValue; ?>:&lt;/strong> &lt;?= $optionValue; ?>&lt;br />
                    &lt;?php endforeach; ?>
                &lt;/p>
            &lt;?php endif; ?>

        &lt;/td>
        &lt;td style="text-align:right">&lt;?= CNumber::format($items['price']); ?>&lt;/td>
        &lt;td style="text-align:right">$&lt;?= CNumber::format($items['subtotal']); ?>&lt;/td>
    &lt;/tr>
&lt;?php $i++; ?>
&lt;?php endforeach; ?>
&lt;tr>
  &lt;td colspan="2"> &lt;/td>
  &lt;td class="right">&lt;strong>Total&lt;/strong>&lt;/td>
  &lt;td class="right">&lt;?= CNumber::format($shoppingCart->total()); ?>&lt;/td>
&lt;/tr>
&lt;/table>
</pre>


<a name="function-reference"></a>
<h3>Function Reference <a class="hashlink" href="#function-reference">¶</a></h3>

Permits adding items to the shopping cart, as outlined above.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->insert();</pre>
<br>

Permits updating items in the shopping cart, as outlined above.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->update();</pre>
<br>

Displays the total amount (sum) in the cart.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->total();</pre>
<br>
	
Displays the total number of items in the cart.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->totalItems();</pre>
<br>	

Returns an array containing everything in the cart.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->contents();</pre>
<br>	

Returns an array of the particular product.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->getItem();</pre>
<br>	

Returns true (boolean) if a particular row in the cart contains options.
This function is designed to be used in a loop with <code>A::app()->getShoppingCart()->contents()</code>,
since you must pass the rowid to this function, as shown in the Displaying the Cart example above.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->hasOptions();</pre>
<br>
	
Returns an array of options for a particular product. This function is designed to be used in a loop with
<code>A::app()->getShoppingCart()->contents()</code>, since you must pass the rowid to this function, as
shown in the Displaying the Cart example above.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->productOptions();</pre>
<br>	

Permits you to destroy the cart. This function will likely be called when you are finished processing the customer's order.
<pre name="dlhl" class="php">A::app()->getShoppingCart()->destroy();</pre>
<br><br>

